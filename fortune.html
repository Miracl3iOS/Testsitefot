<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–ö–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã ‚Äî –∫—É–ø–æ–Ω</title>
<style>
:root{
  --bg:#f0f0f3; --card:#f7f7fb; --ink:#2f2f36;
  --shadow:5px 5px 10px #cfcfd6, -5px -5px 10px #ffffff;
  --inset:inset 5px 5px 10px #cfcfd6, inset -5px -5px 10px #ffffff;
  --maxw:428px;
  --accent1:#ffb366; --accent2:#ff6f00;
  --btn-grad-from:#c5113a; --btn-grad-to:#ff6ea9;
}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);
  font:15px/1.4 -apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",Roboto,Arial;
  -webkit-font-smoothing:antialiased;overflow-x:hidden}
.phone{width:min(100vw,var(--maxw));margin:0 auto;min-height:100dvh;background:var(--bg);
  box-shadow:var(--shadow);border-radius:24px;overflow:hidden;display:flex;flex-direction:column}
.status{height:56px;display:flex;align-items:center;justify-content:space-between;padding:0 16px}
.center{background:var(--bg);box-shadow:var(--shadow);border-radius:18px;padding:8px 14px;font-weight:700;font-size:12px;color:#5b5c64}
.menu-btn{width:48px;height:34px;border:none;border-radius:12px;background:var(--bg);box-shadow:var(--shadow);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;cursor:default}
.menu-btn span{width:22px;height:2.5px;background:#000;border-radius:3px}
.back{display:inline-block;text-decoration:none;font-weight:700;color:#2f2f36;background:#fff;padding:8px 12px;border-radius:12px;box-shadow:var(--shadow)}

.wrap{padding:12px 16px 22px}
.headline{margin:8px 0 6px;font-weight:900;font-size:clamp(22px,6vw,34px);line-height:1.08;color:#fff5e6;
  text-shadow:0 0 4px #fff2cc,0 0 10px var(--accent1),0 0 22px #ff9900,0 0 32px var(--accent2)}
.sub{margin:4px 0 14px;color:#3c3d46;font-size:14px}

.card{background:var(--card);box-shadow:var(--shadow);border-radius:20px;padding:16px;display:flex;flex-direction:column;gap:14px}

/* –∫–æ–ª–µ—Å–æ */
.wheel-wrap{position:relative;display:flex;align-items:center;justify-content:center;background:var(--bg);
  border-radius:18px;padding:12px;box-shadow:var(--inset)}
.wheel-box{width:min(84vw,360px);height:min(84vw,360px);max-width:360px;max-height:360px;position:relative}
.pointer{position:absolute;left:50%;bottom:-4px;transform:translateX(-50%);
  width:0;height:0;border-left:13px solid transparent;border-right:13px solid transparent;border-top:22px solid #d28a00;
  filter:drop-shadow(0 2px 0 rgba(0,0,0,.25))}
.bulb{fill:#ffe9a8;stroke:#e1a400;stroke-width:3px;filter:drop-shadow(0 1px 1px rgba(0,0,0,.3))}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}} .blink .bulb{animation:blink .35s linear infinite}

/* –∫–Ω–æ–ø–∫–∞, –∏–Ω—Ñ–æ */
.spin-btn{display:flex;align-items:center;justify-content:center;gap:10px;padding:14px 18px;border-radius:14px;
  text-decoration:none;font-weight:900;font-size:16px;letter-spacing:.3px;color:#111;border:1px solid #000;
  background:linear-gradient(135deg,var(--btn-grad-from) 0%,#e11e3a 35%,#ff3b5f 70%,var(--btn-grad-to) 100%);
  box-shadow:0 0 10px rgba(255,61,112,.35),0 0 20px rgba(255,110,169,.25),var(--shadow);transition:transform .12s ease,box-shadow .12s ease}
.spin-btn:active{transform:translateY(1px) scale(.985);box-shadow:var(--inset)}
.spin-btn[disabled]{opacity:.6;filter:grayscale(.2);cursor:not-allowed}

.status-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
.timer-pill{padding:8px 10px;border-radius:12px;background:#fff;color:#333;font-weight:800;font-size:13px;box-shadow:var(--shadow)}
.copy-row{display:flex;gap:8px;align-items:center;justify-content:flex-end}
.code{padding:8px 10px;border-radius:12px;background:#fff;box-shadow:var(--shadow);
  font-family:ui-monospace,SFMono-Regular,Menlo,monospace;font-weight:800;font-size:13px;color:#111}
.copy-btn{padding:8px 12px;border-radius:10px;background:#111;color:#fff;font-weight:800;text-decoration:none;box-shadow:0 2px 0 rgba(0,0,0,.35),var(--shadow)}
.copy-btn:active{transform:scale(.98)}

.footer{padding:12px 16px;font-size:12px;color:#666;text-align:center}
.footer a{color:#3a3b44;font-weight:700;text-decoration:none;border-bottom:1px dashed #3a3b44}
.footer a:hover{border-bottom-style:solid}

.toast{position:fixed;left:50%;bottom:16px;transform:translate(-50%,140%);width:min(92vw,420px);z-index:60;background:var(--card);box-shadow:var(--shadow);border-radius:18px;padding:14px;transition:transform .28s ease}
.toast.show{transform:translate(-50%,0)}
.toast h4{margin:0 0 6px;font-size:16px}
.toast p{margin:0 0 10px;color:#444;font-size:14px}
.toast .row{display:flex;justify-content:space-between;gap:8px;align-items:center}
.tg-btn{display:inline-flex;align-items:center;gap:8px;text-decoration:none;background:#111;color:#fff;padding:10px 12px;border-radius:12px;font-weight:800;box-shadow:0 2px 0 rgba(0,0,0,.35),var(--shadow)}
.tg-btn svg{width:18px;height:18px;display:block}
.toast .close{border:none;background:transparent;font-size:20px;line-height:1;cursor:pointer;padding:6px 8px;border-radius:10px}
.toast .close:active{background:#eee}
</style>
</head>
<body>
<main class="phone">
  <div class="status">
    <a class="back" href="index.html">‚Üê –ù–∞–∑–∞–¥</a>
    <div class="center">TELEGRAM</div>
    <button class="menu-btn" aria-label="–ú–µ–Ω—é" disabled><span></span><span></span><span></span></button>
  </div>

  <section class="wrap">
    <h1 class="headline">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∫–æ–ª–µ—Å–æ —Ñ–æ—Ä—Ç—É–Ω—ã</h1>
    <p class="sub">–ö—Ä—É—Ç–∏—Ç–µ –∫–æ–ª–µ—Å–æ 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏ –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –∫—É–ø–æ–Ω. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –ø–æ –Ω–∞—Å—Ç–æ—è—â–µ–º—É —É–≥–ª—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å—Ç—Ä–µ–ª–∫–∏.</p>

    <div class="card">
      <div class="wheel-wrap">
        <div class="wheel-box">
          <div class="pointer" aria-hidden="true"></div>
          <!-- SVG —Å–æ–∑–¥–∞—ë–º –ø—É—Å—Ç—ã–º: JS –ø–æ—Å—Ç—Ä–æ–∏—Ç –≤—Å—é –≥–µ–æ–º–µ—Ç—Ä–∏—é –ø–æ —Ñ–æ—Ä–º—É–ª–∞–º -->
          <svg id="wheelSVG" viewBox="0 0 1000 1000" width="100%" height="100%" style="display:block"></svg>
        </div>
      </div>

      <button id="spinBtn" class="spin-btn">–ö–†–£–¢–ò–¢–¨</button>

      <div class="status-row">
        <div class="timer-pill"><span id="timer">–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å</span></div>
        <div class="copy-row">
          <div class="code" id="couponCode">–ö—É–ø–æ–Ω –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å</div>
          <button class="copy-btn" id="copyBtn" disabled>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">–°–¥–µ–ª–∞–Ω–æ —Å üíõ ‚Ä¢ <a href="https://t.me/" target="_blank" rel="noopener">–Ω–∞—à TELEGRAM</a></footer>
</main>

<!-- Toast -->
<div class="toast" id="toast">
  <div class="row">
    <h4 id="toastTitle">–°–æ–æ–±—â–µ–Ω–∏–µ</h4>
    <button class="close" id="toastClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
  </div>
  <p id="toastText"></p>
  <a href="https://t.me/" target="_blank" rel="noopener" class="tg-btn" id="toastBtn" style="display:none">
    <svg viewBox="0 0 24 24" aria-hidden="true"><path fill="#fff" d="M9.04 15.46 8.7 18.88c.48 0 .76-.2 1.06-.47l2.55-2.35 5.18 3.68c.98.62 1.67.31 1.95-.92l3.62-16.9c.26-1.22-.43-1.68-1.39-1.31L1.3 9.06C.14 9.52.15 10.22 1 10.5–ª5.36 1.67L19 4.33c.61-.36 1.08-.16.69.22L9.04 15.46Z"/></svg>
    –û–ø–µ—Ä–∞—Ç–æ—Ä
  </a>
</div>

<script>
/* ---------- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ---------- */
const N = 12;                                 // —á–∏—Å–ª–æ —Å–µ–∫—Ç–æ—Ä–æ–≤
const FULL = Math.PI * 2;
const STEP = FULL / N;                        // —à–∞–≥ —Å–µ–∫—Ç–æ—Ä–∞
const CENTER = { x: 500, y: 500 };
const R_OUT = 420;                            // –≤–Ω–µ—à–Ω–∏–π —Ä–∞–¥–∏—É—Å –∫–ª–∏–Ω—å–µ–≤
const R_LABEL = 265;                          // —Ä–∞–¥–∏—É—Å —Ç–µ–∫—Å—Ç–∞
const R_BULB = 470;                           // —Ä–∞–¥–∏—É—Å –ª–∞–º–ø–æ—á–µ–∫
const POINTER_OFFSET = Math.PI;               // —É–∫–∞–∑–∞—Ç–µ–ª—å —Å–Ω–∏–∑—É (180¬∞)

/* ---------- –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–æ–≤ ---------- */
const SEGMENTS = [
  { label:'500‚ÇΩ',  type:'coupon', value:'500' },
  { label:'–ü–£–°–¢–û', type:'none'   },
  { label:'700‚ÇΩ',  type:'coupon', value:'700' },
  { label:'900‚ÇΩ',  type:'coupon', value:'900' },
  { label:'–ü–£–°–¢–û', type:'none'   },
  { label:'1200‚ÇΩ', type:'coupon', value:'1200'},
  { label:'1500‚ÇΩ', type:'coupon', value:'1500'},
  { label:'–ü–£–°–¢–û', type:'none'   },
  { label:'2000‚ÇΩ', type:'coupon', value:'2000'},
  { label:'300‚ÇΩ',  type:'coupon', value:'300' },
  { label:'1100‚ÇΩ', type:'coupon', value:'1100'},
  { label:'–°–Æ–†–ü–†–ò–ó', type:'coupon', value:'SP'},
];

/* ---------- –£—Ç–∏–ª–∏—Ç—ã –≥–µ–æ–º–µ—Ç—Ä–∏–∏ ---------- */
const toDeg = rad => rad * 180 / Math.PI;
const norm = a => ((a % FULL) + FULL) % FULL;          // –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è 0..2œÄ
const polar = (r, ang) => [CENTER.x + r * Math.cos(ang), CENTER.y + r * Math.sin(ang)];
function wedgePath(a0, a1, r){                         // —Å–µ–∫—Ç–æ—Ä –æ—Ç —É–≥–ª–∞ a0 –∫ a1
  const [x0,y0]=polar(r,a0), [x1,y1]=polar(r,a1);
  const largeArc = (a1-a0) % FULL > Math.PI ? 1 : 0;
  // –∏–∑ —Ü–µ–Ω—Ç—Ä–∞ -> –Ω–∞ –¥—É–≥—É -> –Ω–∞–∑–∞–¥ –≤ —Ü–µ–Ω—Ç—Ä
  return `M ${CENTER.x},${CENTER.y} L ${x0},${y0} A ${r},${r} 0 ${largeArc} 1 ${x1},${y1} Z`;
}
/* –∏–Ω–¥–µ–∫—Å —Å–µ–∫—Ç–æ—Ä–∞ –ø–æ–¥ —É–∫–∞–∑–∞—Ç–µ–ª–µ–º (–≤–Ω–∏–∑—É) –ø—Ä–∏ —É–≥–ª–µ –≤—Ä–∞—â–µ–Ω–∏—è rot */
function indexFromRotation(rot){
  // –ø–æ–¥ —Å—Ç—Ä–µ–ª–∫–æ–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Å–µ–∫—Ç–æ—Ä, —á–µ–π —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —É–≥–æ–ª –±–ª–∏–∂–µ –≤—Å–µ–≥–æ –∫ (POINTER_OFFSET - rot)
  const theta = norm(POINTER_OFFSET - norm(rot));
  return Math.floor(theta / STEP) % N;
}

/* ---------- –†–∏—Å—É–µ–º SVG –∫–æ–ª–µ—Å–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ ---------- */
const svg = document.getElementById('wheelSVG');
function drawWheel(){
  // –æ–±–æ–¥
  const ring1 = document.createElementNS('http://www.w3.org/2000/svg','circle');
  ring1.setAttribute('cx',CENTER.x); ring1.setAttribute('cy',CENTER.y);
  ring1.setAttribute('r', R_BULB); ring1.setAttribute('fill','none');
  ring1.setAttribute('stroke','#b86a00'); ring1.setAttribute('stroke-width','30');
  const ring2 = document.createElementNS('http://www.w3.org/2000/svg','circle');
  ring2.setAttribute('cx',CENTER.x); ring2.setAttribute('cy',CENTER.y);
  ring2.setAttribute('r', R_BULB); ring2.setAttribute('fill','none');
  ring2.setAttribute('stroke','#e3a300'); ring2.setAttribute('stroke-width','18');
  svg.appendChild(ring1); svg.appendChild(ring2);

  // –ª–∞–º–ø–æ—á–∫–∏ (36 —à—Ç)
  const bulbs = document.createElementNS('http://www.w3.org/2000/svg','g');
  bulbs.setAttribute('id','bulbRing');
  for(let i=0;i<36;i++){
    const a = i * (FULL/36);
    const [x,y]=polar(R_BULB,a);
    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('class','bulb'); c.setAttribute('r','10');
    c.setAttribute('cx',x); c.setAttribute('cy',y);
    bulbs.appendChild(c);
  }
  svg.appendChild(bulbs);

  // –≥—Ä—É–ø–ø–∞ –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è
  const g = document.createElementNS('http://www.w3.org/2000/svg','g');
  g.setAttribute('id','wheelGroup');
  svg.appendChild(g);

  // 12 –∫–ª–∏–Ω—å–µ–≤
  for(let i=0;i<N;i++){
    const a0 = -Math.PI/2 + i*STEP;         // —Å—Ç–∞—Ä—Ç –æ—Ç ¬´—Å–µ–≤–µ—Ä–∞¬ª, –ø–æ —á–∞—Å–æ–≤–æ–π
    const a1 = a0 + STEP;
    const seg = document.createElementNS('http://www.w3.org/2000/svg','path');
    seg.setAttribute('d', wedgePath(a0,a1,R_OUT));
    const colors = ['#941f12','#a82316','#b82719','#cd2c1d'];
    seg.setAttribute('fill', colors[i%colors.length]);
    seg.setAttribute('stroke','#7d170f'); seg.setAttribute('stroke-width','2');
    g.appendChild(seg);

    // —Ç–µ–∫—Å—Ç –ø–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º—É –ª—É—á—É —Å–µ–∫—Ç–æ—Ä–∞ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ)
    const mid = (a0+a1)/2;
    const [tx,ty] = polar(R_LABEL, mid);
    const label = document.createElementNS('http://www.w3.org/2000/svg','text');
    label.setAttribute('x', tx); label.setAttribute('y', ty);
    label.setAttribute('fill', '#ffd86b');
    label.setAttribute('font-size','44'); label.setAttribute('font-weight','900');
    label.setAttribute('text-anchor','middle'); label.setAttribute('dominant-baseline','middle');
    label.style.writingMode = 'vertical-rl';           // –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ
    label.style.textOrientation = 'upright';
    label.textContent = SEGMENTS[i].label;
    g.appendChild(label);

    if(SEGMENTS[i].type==='none'){ // —á–µ—Ä–µ–ø –¥–ª—è –ø—É—Å—Ç–æ–≥–æ
      const [sx,sy] = polar(R_LABEL-40, mid);
      const skull = document.createElementNS('http://www.w3.org/2000/svg','text');
      skull.setAttribute('x',sx); skull.setAttribute('y',sy);
      skull.setAttribute('text-anchor','middle'); skull.setAttribute('dominant-baseline','middle');
      skull.setAttribute('font-size','58'); skull.textContent='üíÄ';
      g.appendChild(skull);
    }
  }

  // —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —à–∞–π–±–∞
  const c1 = document.createElementNS('http://www.w3.org/2000/svg','circle');
  c1.setAttribute('cx',CENTER.x); c1.setAttribute('cy',CENTER.y); c1.setAttribute('r','90'); c1.setAttribute('fill','#e3a300');
  const c2 = document.createElementNS('http://www.w3.org/2000/svg','circle');
  c2.setAttribute('cx',CENTER.x); c2.setAttribute('cy',CENTER.y); c2.setAttribute('r','60'); c2.setAttribute('fill','#ffd86b');
  svg.appendChild(c1); svg.appendChild(c2);
}
drawWheel();

/* ---------- –ó–≤—É–∫ (–º—è–≥–∫–∏–π) ---------- */
let AC;
function ensureAC(){ if(!AC){ try{ AC=new (window.AudioContext||window.webkitAudioContext)(); }catch(e){} } }
function wood({freq=500,duration=90,gain=0.02,type='triangle'}){ try{ ensureAC(); if(!AC) return; const o=AC.createOscillator(), g=AC.createGain(); o.type=type; o.frequency.value=freq; const t=AC.currentTime; g.gain.setValueAtTime(0,t); g.gain.linearRampToValueAtTime(gain,t+0.01); g.gain.exponentialRampToValueAtTime(0.0001,t+duration/1000); o.connect(g).connect(AC.destination); o.start(t); o.stop(t+duration/1000);}catch(e){} }
function tickSound(){ wood({freq:650,duration:70,gain:0.015}); }
function winSound(){ [740,880,1175].forEach((f,i)=>setTimeout(()=>wood({freq:f,duration:140,gain:0.025}),i*140)); }
function loseSound(){ wood({freq:220,duration:200,gain:0.02,type:'sine'}); setTimeout(()=>wood({freq:170,duration:240,gain:0.018}),160); }

/* ---------- –ö—É–ø–æ–Ω—ã/—Ç–∞–π–º–µ—Ä/—Ç–æ—Å—Ç—ã ---------- */
const KEY_LAST='fortune_last_spin_at_v7', KEY_COUP='fortune_last_coupon_v7', COOLDOWN=24*60*60*1000;
const spinBtn=document.getElementById('spinBtn'), timerEl=document.getElementById('timer'), couponEl=document.getElementById('couponCode'), copyBtn=document.getElementById('copyBtn');
const toast=document.getElementById('toast'), toastTitle=document.getElementById('toastTitle'), toastText=document.getElementById('toastText'), toastBtn=document.getElementById('toastBtn');
document.getElementById('toastClose').onclick=()=>toast.classList.remove('show');

function pad(n){return String(n).padStart(2,'0')}
function fmtLeft(ms){const h=Math.floor(ms/3600000),m=Math.floor((ms%3600000)/60000),s=Math.floor((ms%60000)/1000);return `${pad(h)}:${pad(m)}:${pad(s)}`}
function setCouponText(t,enableCopy){couponEl.textContent=t; copyBtn.disabled=!enableCopy;}
const getLast=()=>Number(localStorage.getItem(KEY_LAST))||0;
const getLeft=()=>Math.max(0, getLast()+COOLDOWN - Date.now());
const saveLastNow=()=>localStorage.setItem(KEY_LAST,String(Date.now()));
const saveCoupon=c=>localStorage.setItem(KEY_COUP,c);
function tickTimer(){const left=getLeft(); if(left>0){timerEl.textContent='–°–ª–µ–¥—É—é—â–µ–µ —á–µ—Ä–µ–∑ '+fmtLeft(left); spinBtn.disabled=true; requestAnimationFrame(tickTimer);} else {timerEl.textContent='–î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å'; spinBtn.disabled=false;}}
tickTimer();
const saved=localStorage.getItem(KEY_COUP); if(saved){ setCouponText(`–ö—É–ø–æ–Ω ‚Äî ${saved}`,true); }
function makeCoupon(prize){const A='ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; let r=''; for(let i=0;i<6;i++) r+=A[Math.floor(Math.random()*A.length)]; const amount=prize.value==='SP'?'–°–Æ–†–ü–†–ò–ó':`${prize.value}‚ÇΩ`; const code=prize.value==='SP'?`SP-${r}`:`D${prize.value}-${r}`; return {display:`${amount} ‚Äî ${code}`, raw:code, amount};}
function showToast(type,coupon){
  if(type==='win'){ toastTitle.textContent='üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!'; toastText.textContent=`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –∫—É–ø–æ–Ω ${coupon.display}. –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫—É–ø–æ–Ω–∞ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É.`; toastBtn.style.display='inline-flex'; }
  else { toastTitle.textContent='üíÄ –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–≥–æ–¥–Ω—è –ø—É—Å—Ç–æ!'; toastText.textContent='–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑.'; toastBtn.style.display='none'; }
  toast.classList.add('show');
}

/* ---------- –í—Ä–∞—â–µ–Ω–∏–µ (–µ–¥–∏–Ω–∞—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –¥–ª—è iOS/Android/–ü–ö) ---------- */
let rotation = 0;           // —Ç–µ–∫—É—â–∏–π —É–≥–æ–ª (—Ä–∞–¥), –ø–æ —á–∞—Å–æ–≤–æ–π
let spinning = false;
let lastTickIdx = -1;

function applyRotation(){
  const g = document.getElementById('wheelGroup');
  g.setAttribute('transform', `rotate(${toDeg(rotation)} ${CENTER.x} ${CENTER.y})`);
}
function flashBulbs(on=true){
  const s = document.getElementById('wheelSVG');
  if(on){ s.classList.add('blink'); setTimeout(()=>flashBulbs(false), 2500); }
  else { s.classList.remove('blink'); }
}

function spin(){
  if(spinning) return;
  const left=getLeft(); if(left>0){timerEl.style.transform='scale(1.04)'; setTimeout(()=>timerEl.style.transform='',120); return;}
  ensureAC(); spinning=true; spinBtn.disabled=true; setCouponText('–ö—Ä—É—Ç–∏–º –∫–æ–ª–µ—Å–æ‚Ä¶',false); lastTickIdx=-1;

  const minTurns=4, maxTurns=7;
  const target = rotation + (minTurns + Math.random()*(maxTurns-minTurns)) * FULL; // –∫—É–¥–∞ —Ö–æ—Ç–∏–º –ø—Ä–∏–π—Ç–∏
  const duration = 3600 + Math.random()*1200;
  const start = performance.now();
  const startAngle = rotation;

  const easeOut = t => 1 - Math.pow(1-t,3);

  function frame(now){
    const t = Math.min(1, (now-start)/duration);
    rotation = norm( startAngle + (target-startAngle)*easeOut(t) );
    applyRotation();

    // —â–µ–ª—á–æ–∫ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ —á–µ—Ä–µ–∑ –≥—Ä–∞–Ω–∏—Ü—É —Å–µ–∫—Ç–æ—Ä–∞
    const idx = indexFromRotation(rotation);
    if(idx !== lastTickIdx){ tickSound(); lastTickIdx = idx; }

    if(t < 1) { requestAnimationFrame(frame); }
    else {
      rotation = norm(rotation); applyRotation();
      const i = indexFromRotation(rotation);
      const prize = SEGMENTS[i];

      if(prize.type==='none'){
        loseSound(); flashBulbs(true);
        setCouponText('–£–≤—ã, –ø—É—Å—Ç–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞!', false);
        showToast('lose'); saveLastNow(); spinning=false; tickTimer(); return;
      }
      winSound(); flashBulbs(true);
      const coupon = makeCoupon(prize);
      setCouponText(coupon.display, true);
      saveCoupon(coupon.raw); saveLastNow();
      showToast('win', coupon);
      spinning=false; tickTimer();
    }
  }
  requestAnimationFrame(frame);
}

spinBtn.addEventListener('click', spin);
copyBtn.addEventListener('click', e=>{
  const text=couponEl.textContent.trim();
  if(!text || text.includes('–ø–æ—è–≤–∏—Ç—Å—è') || text.includes('–ø—É—Å—Ç–æ')) return;
  navigator.clipboard.writeText(text).then(()=>{
    const old=e.target.textContent; e.target.textContent='–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ';
    setTimeout(()=>e.target.textContent=old,900);
  });
});

/* —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –ø—Ä–æ—Ä–∏—Å–æ–≤–∫–∞ */
applyRotation();
</script>
</body>
</html>
